<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SharePoint AI Search Bot</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: auto; }
    .msg { margin: 8px 0; }
    .user { font-weight: bold; color: #0078d4; }
    .bot { color: #333; }
  </style>
</head>
<body>
  <h2>SharePoint Search Assistant</h2>
  <div id="chat"></div>
  <input id="query" type="text" placeholder="Ask me something..." style="width:80%;">
  <button onclick="search()">Search</button>

  <script>
    async function search() {
      const input = document.getElementById('query');
      const queryText = input.value.trim();
      if (!queryText) return;

      const chat = document.getElementById('chat');
      chat.innerHTML += `<div class='msg user'>You: ${queryText}</div>`;

      const url = `/_api/search/query?querytext='${encodeURIComponent(queryText)}'`;
      try {
        const res = await fetch(url, {
          headers: { "Accept": "application/json;odata=verbose" }
        });
        const data = await res.json();
        const results = data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;
        if (results.length === 0) {
          chat.innerHTML += `<div class='msg bot'>No results found.</div>`;
        } else {
          chat.innerHTML += `<div class='msg bot'>Found ${results.length} results:</div>`;
          results.forEach(r => {
            const cells = r.Cells.results;
            const title = cells.find(c => c.Key === 'Title')?.Value || 'Untitled';
            const path = cells.find(c => c.Key === 'Path')?.Value || '#';
            chat.innerHTML += `<div class='msg bot'><a href='${path}' target='_blank'>${title}</a></div>`;
          });
        }
        chat.scrollTop = chat.scrollHeight;
      } catch (err) {
        chat.innerHTML += `<div class='msg bot'>Error: ${err.message}</div>`;
      }
      input.value = '';
    }
  </script>
</body>
</html>
